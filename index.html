
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description" content="PBR3DGen: A VLM-guided mesh generation with high-quality PBR textures">
  <meta name="keywords" content="PBR3DGen, diffusion, PBR textures, 3D contents, generation">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PBR3DGen</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
      .render_wrapper {
          position: relative;
          height: 300px;
       }
      .render_wrapper_small {
          position: relative;
          height: 200px;
       }
      .render_div {
          position: absolute;
          top: 0;
          left: 0;
      }
      .render_text {
          width: 100%;
          height: 100%;
          display: block;
          font-size: medium;
          padding: 10px;
          text-align: center;
      }

      #interpolation-image-wrapper-car{
          text-align: center;
      }
      #interpolation-image-wrapper-chair{
          text-align: center;
      }
      .nested-columns {
          margin-bottom: 0 !important;
      }

    .hero {
      width: 100%;
      overflow: hidden;
      background-color: #fff;
    }
    
   .carousel-container {
      width: calc(100% - 200px); /* 页面宽度减去左右各100px的间距 */
      overflow: hidden; /* 隐藏超出范围的内容 */
      position: relative;
    }
    
    .carousel {
      display: flex;
      animation: scroll-left 15s linear infinite;
    }
    .item {
      flex: 0 0 100%; 
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .media-video, .media-image {
      width: 50%; 
      height: auto;
    }

    .media-video {
      object-fit: cover; 
    }

  /* 设置图片样式 */
  .media-image {
    width: 50%; /* 图片占一半宽度 */
    height: auto; /* 保持图片比例 */
    background-color: #f0f0f0; /* 设置浅灰色背景 */
    padding: 10px; /* 给图片内容增加一些内边距，使其与背景有间距 */
    box-sizing: border-box; /* 确保 padding 不影响图片宽度 */
  }

.media-text {
  width: 50%;
  height: auto;
  background-color: #f0f0f0;
  padding: 10px;
  box-sizing: border-box;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-family: 'Dancing Script', cursive; /* 改为艺术字体 */
  font-size: 18px; /* 调整字体大小 */
  font-weight: 700; /* 加粗 */
  font-style: italic; /* 设置斜体 */
  color: #555; /* 柔和的灰色 */
  letter-spacing: 1px; /* 增加字间距 */
  line-height: 1.6; /* 行高 */
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2); /* 添加轻微阴影，增强立体感 */
}
    
/*     @keyframes scroll-left {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-100%);
      }
    } */
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>

</head>

<body>


  <section class="hero">
      <div class="hero-body">
          <div class="container is-max-desktop">
              <div class="columns is-centered">
                  <div class="column has-text-centered">
                      <p class="title is-2"> <img id="logo" style="position: relative; top: 2.5px; height: 55px;" src="./static/icon/icon.png"> PBR3DGen: A VLM-guided mesh generation with high-quality PBR textures </p><br>
                      <div class="column has-text-centered">
                          <div class="publication-links">
                            <span class="link-block">
                              <a href=""
                                 class="external-link button is-normal is-rounded is-dark">
                                <span class="icon">
                                    <i class="ai ai-arxiv"></i>
                                </span>
                                <span>arXiv</span>
                              </a>
                            </span>
                              <!-- Code Link. -->
                              <span class="link-block">
                              <a href=""
                                 class="external-link button is-normal is-rounded is-dark">
                                <span class="icon">
                                    <i class="fab fa-github"></i>
                                </span>
                                <span>Code</span>
                                </a>
                            </span>
                              <!-- Video Link. -->
                              <span class="link-block">
                              <a href=""
                                 class="external-link button is-normal is-rounded is-dark">
                                <span class="icon">
                                    <i class="fab fa-youtube"></i>
                                </span>
                                <span>Video</span>
                              </a>
                            </span>
                          </div>
                      </div>
  
  <!--                     <div class="is-size-5 publication-authors"> -->
                      
  <!--                         <img src="./static/imgs/teaser.jpg">
                          <h2 class="subtitle has-text-centered">
                              We present PBR3DGen, a novel two-stage 3D assets generation framework with high-quality physically-based rendering materials. 
                            All objects in the scene are generated from PBR3DGen.
                          </h2> -->
  <!--                     </div> -->
  
                  </div>
              </div>
          </div>
      </div>
  </section>
  
  <section class="hero teaser">
      <div class="container is-max-desktop">
          <div class="hero-body">
<!--               <img src="./static/imgs/teaser.jpg"> -->
              <video id="teaser" autoplay muted loop playsinline width="120%">
                  <source src="./static/videos/teaser_video.mp4"
                      type="video/mp4">
              </video>
              <!-- <h2 class=" subtitle has-text-centered" style="padding-top: 10px">
                  A gallery of generated results by our Point-UV Diffusion. Our method is capable of processing meshes of any genus, generating diversified, geometry-compatible, and high-fidelity textures. 
              </h2> -->
          </div>
      </div>
  </section>
    
  <section class="section">
      <div class="container is-max-desktop">
          <!-- Abstract. -->
          <div class="columns is-centered has-text-centered">
              <div class="column is-four-fifths">
                  <h2 class="title is-3">Abstract</h2>
                  <div class="content has-text-justified">
                      <p>
                        we present <span class="dnerf">PBR3DGen</span>, a two-stage mesh generation method with high-quality PBR materials that integrates the novel multi-view PBR 
                        material estimation model and a 3D PBR mesh reconstruction model. Specifically, PBR3DGen leverages vision 
                        language models (VLM) to guide multi-view diffusion, precisely capturing the spatial distribution and inherent
                        attributes of reflective-metalness material. Additionally, we incorporate view-dependent illumination-aware conditions
                        as pixel-aware priors to enhance spatially varying material properties. Furthermore, our reconstruction model 
                        reconstructs high-quality mesh with PBR material. Experimental results demonstrate that PBR3DGen significantly outperforms existing methods, 
                        achieving new state-of-the-art results for PBR estimation and mesh generation.
                      </p>
                  </div>
                <h2 class="title is-3">Method Overview </h2>
                <img src="./static/imgs/overview.jpg">
                <p align="left"><b>Overall pipeline.</b> This pipeline of PBR3DGen is composed of Multi-View PBR generation module and PBR-LRM module.</p>
              </div>
          </div>
          <!--/ Abstract. -->
          <!-- Paper video. -->
          <div class="columns is-centered has-text-centered">
              <div class="column is-four-fifths">
                  <h2 class="title is-3">Video</h2>
                  <video id="replay-video1"
                         autoplay
                         loop
                         controls
                         muted
                         preload
                         playsinline
                         width="120%"
                         height="120%">
                      <source src="./static/videos/teaser.mp4"
                              type="video/mp4">
                  </video>
                <h2 class="title is-3" style="margin-top: 50px"> More Results </h2>
              </div>
          </div> 
          <!--/ Paper video. -->
      </div>
  </section> 

  <section class="section">
    <div class="container is-max-desktop">
        <div class="columns is-centered" id="results-relight" style="margin-top: -50px">
          <div class="column is-full-width">
              <h2 class="title is-4", style=" margin-left: -120px;", style="margin-top: -20px" >Image-condition PBR mesh generation</h2>
          </div> 
        </div>
    </div>
  </section>

  <section class="hero is-light is-small">
    <div class="hero-body">
      <div class="container">
        <div id="results-carousel" class="carousel results-carousel">
          <div class="item item-steve">
            <img class="media-image" src="./static/image2mesh/1.png" alt="Image 1">
            <video poster="" id="steve" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/1.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-chair-tp">
            <img class="media-image" src="./static/image2mesh/2.png" alt="Image 2">
            <video poster="" id="chair-tp" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/2.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-shiba">
            <img class="media-image" src="./static/image2mesh/3.png" alt="Image 3">
            <video poster="" id="shiba" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/3.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-fullbody">
            <img class="media-image" src="./static/image2mesh/4.png" alt="Image 4">
            <video poster="" id="fullbody" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/4.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-blueshirt">
            <img class="media-image" src="./static/image2mesh/5.png" alt="Image 5">
            <video poster="" id="blueshirt" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/5.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-mask">
            <img class="media-image" src="./static/image2mesh/6.png" alt="Image 6">
            <video poster="" id="mask" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/6.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-coffee">
            <img class="media-image" src="./static/image2mesh/7.png" alt="Image 7">
            <video poster="" id="coffee" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/7.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-toby">
            <img class="media-image" src="./static/image2mesh/8.png" alt="Image 8">
            <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/8.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-toby">
            <img class="media-image" src="./static/image2mesh/9.png" alt="Image 9">
            <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/9.mp4"
                      type="video/mp4">
            </video>
          </div>    
          <div class="item item-toby">
            <img class="media-image" src="./static/image2mesh/10.png" alt="Image 10">
            <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/10.mp4"
                      type="video/mp4">
            </video>
          </div>               
        </div>
      </div>
    </div>
  </section>


<!--   <section class="hero is-light is-small">
    <div class="hero-body">
      <div class="container">
        <div id="results-carousel" class="carousel">
          <div class="item item-steve">
            <video poster="" id="steve" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/1.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-chair-tp">
            <video poster="" id="chair-tp" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/2.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-shiba">
            <video poster="" id="shiba" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/3.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-fullbody">
            <video poster="" id="fullbody" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/4.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-blueshirt">
            <video poster="" id="blueshirt" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/5.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-mask">
            <video poster="" id="mask" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/6.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-coffee">
            <video poster="" id="coffee" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/7.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-toby">
            <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/8.mp4"
                      type="video/mp4">
            </video>
          </div>
          <div class="item item-toby">
            <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/9.mp4"
                      type="video/mp4">
            </video>
          </div>    
          <div class="item item-toby">
            <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/10.mp4"
                      type="video/mp4">
            </video>
          </div>  
          <div class="item item-toby">
            <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
              <source src="./static/image2mesh/11.mp4"
                      type="video/mp4">
            </video>
          </div>   
        </div>
      </div>
    </div>
  </section> -->


  
  <section class="section">
    <div class="container is-max-desktop">
        <div class="columns is-centered" id="results-text2mesh" style="margin-top: -30px">
          <div class="column is-full-width">
              <h2 class="title is-4", style=" margin-left: -120px;" , style="margin-top: -20px"  >Text-condition PBR mesh generation</h2>
          </div> 
        </div>
    </div>
  </section>

  <section class="hero is-light is-small">
    <div class="hero-body">
      <div class="container">
        <div id="results-carousel" class="carousel results-carousel">
          <div class="item item-steve">
            <div class="media-text"> "A charming cat figurine with orange spots"</div>
            <video poster="" id="steve" autoplay controls muted loop playsinline width="50%">
              <source src="./static/text2mesh/1.mp4"
                      type="video/mp4">
            </video>
        </div>
        <div class="item item-chair-tp">
          <div class="media-text"> "A cute panda in a shiny blue hoodie, ready for adventure!"</div>
          <video poster="" id="chair-tp" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/2.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-shiba">
          <div class="media-text"> "A sleek, golden cat figurine with a smooth finish, sitting gracefully."</div>
          <video poster="" id="shiba" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/3.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-fullbody">
          <div class="media-text"> "A cozy ceramic sheep with a scarf, holding a teacup."</div>
          <video poster="" id="fullbody" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/4.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-blueshirt">
          <div class="media-text"> "A stylish ceramic cat in a top hat and blue coat."</div>
          <video poster="" id="blueshirt" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/5.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-mask">
          <div class="media-text"> "A vibrant blue metallic frog with glossy skin, perched on a delicate flower."</div>
          <video poster="" id="mask" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/6.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-coffee">
          <div class="media-text"> "A glossy ceramic dog in a graduation gown and cap, with a gold medallion."</div>
          <video poster="" id="coffee" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/7.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-toby">
          <div class="media-text"> "A vibrant parrot with glossy feathers, wearing a metallic blue hat."</div>
          <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/8.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-toby">
          <div class="media-text"> "A glossy plastic Dalmatian with a leather-textured red cap."</div>
          <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/9.mp4"
                    type="video/mp4">
          </video>
        </div>    
        <div class="item item-toby">
          <div class="media-text"> "A charming turtle with a glossy shell, wearing a satin top hat and bow tie."</div>
          <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/10.mp4"
                    type="video/mp4">
          </video>
        </div>  
        <div class="item item-toby">
          <div class="media-text"> "A glossy green frog with a metallic silver crown, sitting on a base."</div>
          <video poster="" id="toby" autoplay controls muted loop playsinline width="50%">
            <source src="./static/text2mesh/11.mp4"
                    type="video/mp4">
          </video>
        </div>   
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
      <div class="columns is-centered" id="results-relight" style="margin-top: -30px">
        <div class="column is-full-width">
            <h2 class="title is-4", style=" margin-left: -120px;" >Applications for 3D generation assets</h2>   
        </div> 
      </div>
  </div>
</section>


  <section class="section">
    <div class="container is-max-desktop">
        <!-- Animation video. -->
          <div class="columns is-centered has-text-centered" style="margin-top: -100px" >
              <div class="column is-four-fifths">
                  <h2 class="title is-5" >Relighting</h3>
                    <video id="replay-video1"
                           autoplay
                           loop
                           controls
                           muted
                           preload
                           playsinline
                           width="300%"
                           style="margin-top: -10px">
                        <source src="./static/videos/relight.mp4"
                                type="video/mp4">
                    </video>
              </div>
          </div> 
      </div>
   </section>


  
  <section class="section">
    <div class="container is-max-desktop">
        <!-- Animation video. -->
          <div class="columns is-centered has-text-centered" style="margin-top: -80px" >
              <div class="column is-four-fifths">
                  <h2 class="title is-5" >Animation</h3>
                    <video id="replay-video2"
                           autoplay
                           loop
                           controls
                           muted
                           preload
                           playsinline
                           width="120%"
                           height="120%"
                           style="margin-top: -15px">
                        <source src="./static/videos/animation.mp4"
                                type="video/mp4">
                    </video>
              </div>
          </div> 
      </div>
    </section>
  
  
<!--   
    <!---------------------------------------------Functions Start-------------------------------------------------->
    <!-- Import maps polyfill -->
    <!-- Remove this when import maps will be widely supported -->
  <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
  <script type="importmap">
      {
          "imports": {
              "three": "./js/three.module.js"
          }
      }
  </script>
  <script type="module">
      import * as THREE from 'three';
  
      import { PLYLoader } from './js/PLYLoader.js';
      import { GLTFLoader } from './js/GLTFLoader.js';
      import { RGBELoader } from './js/RGBELoader.js';
      import { OrbitControls } from './js/OrbitControls.js'
      let div_to_scene = {
          "mesh_tt3d_0": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_1": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_2": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_3": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_4": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_5": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_6": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_7": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_8": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_9": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_10": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_11": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_12": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_13": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_14": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_15": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_16": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_17": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_18": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_19": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_20": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_21": {
              "geo": null,
              "color": null,
          },
          "mesh_tt3d_22": {
              "geo": null,
              "color": null,
          },  
      }
      // let div_to_render_scene = {
      //     "mesh_env_0": {
      //         "0": null,
      //         "1": null,
      //         "2": null,
      //         "geo": null,
      //     },
      //     "mesh_env_1": {
      //         "0": null,
      //         "1": null,
      //         "2": null,
      //         "geo": null,
      //     },
      //     "mesh_env_2": {
      //         "0": null,
      //         "1": null,
      //         "2": null,
      //         "geo": null,
      //     },
      //     "mesh_env_3": {
      //         "0": null,
      //         "1": null,
      //         "2": null,
      //         "geo": null,
      //     },
      // }
      let mouse_button_down = false;
      let list_of_orbit_controls = []
      let style_camera = null;
      let render_colors = true;
      let style_id = "0"
  
      function setup_camera(div_name){
          let container = document.getElementById(div_name);
          let width = container.parentElement.clientWidth;
          let height = container.parentElement.clientHeight;
          console.log(width, height)
          // let camera = new THREE.PerspectiveCamera( 30, width / height, 0.1, 50 );
          // let camera_init_position = new THREE.Vector3( 0.2, 0.35, 1.2 );
          let camera = new THREE.PerspectiveCamera( 35, width / height, 0.1, 50 );
          let camera_init_position = new THREE.Vector3( 1.0, 0.35, 1.2 );
          // if (div_name.includes("tt3d_3") || div_name.includes("tt3d_4") || div_name.includes("tt3d_5") || div_name.includes("tt3d_6") || div_name.includes("tt3d_7") ){
          //     camera_init_position = camera_init_position.multiplyScalar(1.5 * 7.5)
          // }
          // else if (div_name.includes("env")) {
          //     camera_init_position = camera_init_position.multiplyScalar(1.5 * 6.75)
          // }
          // else {
          //     camera_init_position = camera_init_position.multiplyScalar(1.5 * 6)
          // }
          if (div_name.includes("env")) {
              camera_init_position = camera_init_position.multiplyScalar(1.5 * 6.75)
          }
          else {
              camera_init_position = camera_init_position.multiplyScalar(1.5 * 7.5)
          }
          camera.position.set(camera_init_position.x, camera_init_position.y, camera_init_position.z);
          return camera;
      }
  
      function setup_render_divs(div_name, mesh_path){
          const container = document.getElementById(div_name);
          const placeholder = document.createElement('div');
          placeholder.textContent = "Loading..."; 
          container.appendChild(placeholder);
  
          const observer = new IntersectionObserver(entries => {
              if (entries[0].isIntersecting) {
                  observer.unobserve(placeholder); // Stop observing once loaded
                  placeholder.remove(); 
  
                  let camera = setup_camera(div_name)
                  let orbit_control = create_render_div(camera, div_name, mesh_path)
                  list_of_orbit_controls.push(orbit_control)
              }
          });
          observer.observe(placeholder);
      }
  
      function setup_style_render_divs(div_name, mesh_path){
          const container = document.getElementById(div_name);
          const placeholder = document.createElement('div');
          placeholder.textContent = "Loading..."; 
          container.appendChild(placeholder);
  
          const observer = new IntersectionObserver(entries => {
              if (entries[0].isIntersecting) {
                  observer.unobserve(placeholder); // Stop observing once loaded
                  placeholder.remove(); 
  
                  if (style_camera == null) {
                      style_camera = setup_camera(div_name)
                  }
                  let orbit_control = create_style_render_div(style_camera, div_name, mesh_path, true)
                  list_of_orbit_controls.push(orbit_control)
                  document.getElementById("style_button_0").addEventListener("click", set_style_0)
                  document.getElementById("style_button_1").addEventListener("click", set_style_1)
                  document.getElementById("style_button_2").addEventListener("click", set_style_2)
              }
          });
          observer.observe(placeholder);
      }
  
      function create_render_div(camera, div_id, mesh_path) {
          let container;
          let renderer, controls;
  
          init();
          animate();
  
          function init() {
  
              container = document.getElementById(div_id);
              let width = container.parentElement.clientWidth;
              let height = container.parentElement.clientHeight;
  
  
              div_to_scene[div_id]["color"] = new THREE.Scene();
              div_to_scene[div_id]["geo"] = new THREE.Scene();
              div_to_scene[div_id]["color"].background = new THREE.Color( 0xffffff );
              div_to_scene[div_id]["geo"].background = new THREE.Color( 0xffffff );
  
              // PLY file
  
              const loader = new GLTFLoader();
              loader.load(mesh_path, function (geometry) {
  
                  let loaded_mesh = geometry.scene
  
                  const axis = new THREE.Vector3(0, 1, 0); // Rotate around the Y axis
                  const angle = Math.PI / 2; // 45 degrees rotation
                  loaded_mesh.rotateOnAxis(axis, angle);
  
                  div_to_scene[div_id]["color"].add(loaded_mesh);
                  
                  loaded_mesh.traverse(function (child) {
                      if (child.isMesh) {
                          // const geometry = child.geometry;
                          // const material = new THREE.MeshStandardMaterial( { color: 0x444444, flatShading: true } )
                          // const mesh = new THREE.Mesh(geometry, material);
                          // mesh.rotateOnAxis(axis, angle);
                          // div_to_scene[div_id]["geo"].add(mesh);
                          const geometry = child.geometry;
                          // const material = new THREE.MeshStandardMaterial( { color: 0x444444, flatShading: true } )
                          const mesh = new THREE.Mesh(geometry);
                          mesh.rotateOnAxis(axis, angle);
                          div_to_scene[div_id]["geo"].add(mesh);
                      }
                  });
  
              }, (xhr) => {
                  console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
              }, (error) => {
                  console.log(error)
              }
              );
  
              // lights
  
              // div_to_scene[div_id]["geo"].add( new THREE.HemisphereLight( 0x333333, 0x222222 ) );
              // addShadowedLight(div_to_scene[div_id]["geo"], 1, 1, 1, 0xffffff, 1.35 );
              // addShadowedLight(div_to_scene[div_id]["geo"],  0.5, 1, - 1, 0xffffff, 1 );
  
              // renderer
  
              renderer = new THREE.WebGLRenderer( { antialias: true } );
              renderer.setPixelRatio( window.devicePixelRatio );
              renderer.setSize( width, height);
              renderer.outputEncoding = THREE.sRGBEncoding;
              renderer.toneMapping = THREE.ACESFilmicToneMapping ;
              renderer.toneMappingExposure = 0.6;
              renderer.physicallyCorrectLights = true;
  
              renderer.shadowMap.enabled = true;
  
              // Environment map
              let pmremGenerator = new THREE.PMREMGenerator(renderer);
              pmremGenerator.compileEquirectangularShader();
              
              new RGBELoader().setDataType(THREE.FloatType).load('./envs/metro_noord_2k.hdr', function (texture) {
                  const envMap = pmremGenerator.fromEquirectangular(texture).texture;
                  div_to_scene[div_id]["color"].environment = envMap;
                  div_to_scene[div_id]["geo"].environment = envMap;
                  texture.dispose();
                  pmremGenerator.dispose();
              });
  
              container.appendChild( renderer.domElement );
                  
              controls = new OrbitControls(camera, renderer.domElement)
              controls.enableDamping = false
              controls.enableZoom = false; // Disable zoom
  
              // resize
  
              window.addEventListener( 'resize', onWindowResize );
          }
  
          function onWindowResize() {
              let width = container.clientWidth;
              let height = container.clientHeight;
              camera.aspect = width / height;
              camera.updateProjectionMatrix();
              renderer.setSize( width, height );
          }
  
          function animate() {
              requestAnimationFrame( animate );
              render();
          }
  
          function render() {
              renderer.render( div_to_scene[div_id][render_colors ? "color" : "geo"], camera );
              controls.update();
          }
  
          return controls;
      }
  
      function create_style_render_div(camera, div_id, mesh_path) {
          let container;
          let renderer, controls;
  
          init();
          animate();
  
          function init() {
  
              container = document.getElementById(div_id);
              let width = container.parentElement.clientWidth;
              let height = container.parentElement.clientHeight;
  
  
              div_to_render_scene[div_id]["0"] = new THREE.Scene();
              div_to_render_scene[div_id]["1"] = new THREE.Scene();
              div_to_render_scene[div_id]["2"] = new THREE.Scene();
              // div_to_render_scene[div_id]["0"].background = new THREE.Color( 0xffffff );
              // div_to_render_scene[div_id]["1"].background = new THREE.Color( 0xffffff );
              // div_to_render_scene[div_id]["2"].background = new THREE.Color( 0xffffff );
              div_to_render_scene[div_id]["geo"] = new THREE.Scene();
              div_to_render_scene[div_id]["geo"].background = new THREE.Color( 0xffffff );
  
              const loader = new GLTFLoader();
              ["0", "1", "2"].forEach(id => {
                  loader.load(mesh_path, function (geometry) {
                      let loaded_mesh = geometry.scene
                      const axis = new THREE.Vector3(0, 1, 0); // Rotate around the Y axis
                      const angle = Math.PI / 2; // 45 degrees rotation
                      loaded_mesh.rotateOnAxis(axis, angle);
                      div_to_render_scene[div_id][id].add( loaded_mesh );
                      if (id === "0") {
                          loaded_mesh.traverse(function (child) {
                              if (child.isMesh) {
                                  const geometry = child.geometry;
                                  const material = new THREE.MeshStandardMaterial( { color: 0x444444, flatShading: true } )
                                  const mesh = new THREE.Mesh(geometry, material);
                                  mesh.rotateOnAxis(axis, angle);
                                  div_to_render_scene[div_id]["geo"].add(mesh);
                              }
                          });
                      }
  
                  }, (xhr) => {
                      console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
                  }, (error) => {
                      console.log(error)
                  }
                  )
              })
  
              // div_to_render_scene[div_id]["geo"].add( new THREE.HemisphereLight( 0x333333, 0x222222 ) );
              // addShadowedLight(div_to_render_scene[div_id]["geo"], 1, 1, 1, 0xffffff, 1.35 );
              // addShadowedLight(div_to_render_scene[div_id]["geo"],  0.5, 1, - 1, 0xffffff, 1 );
  
              // renderer
  
              renderer = new THREE.WebGLRenderer( { antialias: true } );
              renderer.setPixelRatio( window.devicePixelRatio );
              renderer.setSize( width, height);
              renderer.outputEncoding = THREE.sRGBEncoding;
              renderer.toneMapping = THREE.ACESFilmicToneMapping;
              renderer.toneMappingExposure = 0.75;
  
              renderer.shadowMap.enabled = true;
  
              const env = {
                  "0": "cyclorama.hdr",
                  "1": "puresky.hdr",
                  "2": "fireplace.hdr",
              };
  
              // Environment map
              ["0", "1", "2"].forEach(id => {
                  let pmremGenerator = new THREE.PMREMGenerator(renderer);
                  pmremGenerator.compileEquirectangularShader();
                  
                  new RGBELoader().setDataType(THREE.FloatType).load('./envs/' + env[id], function (texture) {
                      const envMap = pmremGenerator.fromEquirectangular(texture).texture;
                      div_to_render_scene[div_id][id].background = envMap;
                      div_to_render_scene[div_id][id].environment = envMap;
                      if (id === "0") {
                          div_to_render_scene[div_id]["geo"].environment = envMap;
                      }
                      texture.dispose();
                      pmremGenerator.dispose();
                  });
              })
  
              container.appendChild( renderer.domElement );
  
              controls = new OrbitControls(camera, renderer.domElement)
              controls.enableDamping = false
  
  
              // resize
  
              window.addEventListener( 'resize', onWindowResize );
  
      }
          function onWindowResize() {
              let width = container.clientWidth;
              let height = container.clientHeight;
              camera.aspect = width / height;
              camera.updateProjectionMatrix();
              renderer.setSize( width, height );
          }
          function animate() {
              requestAnimationFrame( animate );
              render();
          }
  
          function render() {
              let scene = render_colors ? div_to_render_scene[div_id][style_id]: div_to_render_scene[div_id]["geo"]
              renderer.render( scene, camera );
              controls.update();
          }
  
          return controls;
      }
  
      function addShadowedLight(scene, x, y, z, color, intensity ) {
  
          const directionalLight = new THREE.DirectionalLight( color, intensity );
          directionalLight.position.set( x, y, z );
          scene.add( directionalLight );
  
          directionalLight.castShadow = true;
  
          const d = 1;
          directionalLight.shadow.camera.left = - d;
          directionalLight.shadow.camera.right = d;
          directionalLight.shadow.camera.top = d;
          directionalLight.shadow.camera.bottom = - d;
  
          directionalLight.shadow.camera.near = 1;
          directionalLight.shadow.camera.far = 4;
  
          directionalLight.shadow.mapSize.width = 1024;
          directionalLight.shadow.mapSize.height = 1024;
  
          directionalLight.shadow.bias = - 0.001;
  
      }
  
      document.addEventListener('keydown', logKey);
  
      function logKey(evt) {
          // if (evt.keyCode === 71 && !mouse_button_down) {
          //     switch_geometry()
          // }
          if (evt.keyCode === 82 && !mouse_button_down) {
              reset_orbit_controls()
          }
      }
  
      function switch_geometry() {
          render_colors = !render_colors
      }
  
      function reset_orbit_controls() {
          list_of_orbit_controls.forEach(oc => {
              oc.reset()
          })
      }
  
      function set_style_0(){
          style_id = "0"
      }
  
      function set_style_1(){
          style_id = "1"
      }
  
      function set_style_2(){
          style_id = "2"
      }
  
      function isMobile() {
          const userAgent = navigator.userAgent || navigator.vendor || window.opera;
          return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent.toLowerCase());
      }
  
      document.body.onmousedown = function(evt) {
          if (evt.button === 0)
              mouse_button_down = true
      }
      document.body.onmouseup = function(evt) {
          if (evt.button === 0)
              mouse_button_down = false
      }
  
      window.onload = function() {
          let slider = document.getElementsByClassName("slider")[0]
          slider.removeAttribute("tabIndex")
          // slider.addEventListener("mouseout", reset_orbit_controls);
  
          if (!isMobile()) {
              // setup_render_divs("mesh_tt3d_0", './static/models/goldentoilet.glb')              
              setup_render_divs("mesh_tt3d_1", './static/models/1.glb')
              setup_render_divs("mesh_tt3d_2", './static/models/2.glb')
              setup_render_divs("mesh_tt3d_3", './static/models/3.glb')
              setup_render_divs("mesh_tt3d_4", './static/models/4.glb')
  
              setup_render_divs("mesh_tt3d_5", './static/models/5.glb')
              setup_render_divs("mesh_tt3d_6", './static/models/6.glb')
              setup_render_divs("mesh_tt3d_7", './static/models/7.glb')
              setup_render_divs("mesh_tt3d_8", './static/models/8.glb')
  
              setup_render_divs("mesh_tt3d_9", './static/models/9.glb')
              setup_render_divs("mesh_tt3d_10", './static/models/10.glb')
              setup_render_divs("mesh_tt3d_11", './static/models/11.glb')
              setup_render_divs("mesh_tt3d_12", './static/models/12.glb')
  
              setup_render_divs("mesh_tt3d_13", './static/models/13.glb')
              setup_render_divs("mesh_tt3d_14", './static/models/14.glb')
              setup_render_divs("mesh_tt3d_15", './static/models/15.glb')
              setup_render_divs("mesh_tt3d_16", './static/models/16.glb')

              setup_render_divs("mesh_tt3d_17", './static/models/17.glb')
              setup_render_divs("mesh_tt3d_18", './static/models/18.glb')
              setup_render_divs("mesh_tt3d_19", './static/models/19.glb')
              setup_render_divs("mesh_tt3d_20", './static/models/20.glb')         
              setup_render_divs("mesh_tt3d_21", './static/models/21.glb')
              setup_render_divs("mesh_tt3d_22", './static/models/22.glb')

              // setup_style_render_divs("mesh_env_0", './models/cat_plastic.glb')
              // setup_style_render_divs("mesh_env_1", './models/cat_rock.glb')
              // setup_style_render_divs("mesh_env_2", './models/cat_silver.glb')
              // setup_style_render_divs("mesh_env_3", './models/cat_rusted.glb')
          } else {
              document.getElementById("results-carousel-0").style.display = 'none';
              document.getElementById("results-carousel-1").style.display = 'none';
              document.getElementById("results-relight").style.display = 'none';
              document.getElementById("message-help").innerHTML = "Please open this page on a non-mobile device to view the generated meshes."
          }
      };
  
  </script> -->


</body>
</html>
